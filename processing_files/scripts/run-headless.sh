#!/bin/bash

GHIDRA_PATH="./tools/ghidra_11.0.3_PUBLIC"
PROJECT_DIR="./tmp_project"
PROJECT_NAME="tmp_project"
SCRIPT_PATH="./scripts/extract_ghidra.py"

echo $1
# Ensure the project directory exists
mkdir -p "$PROJECT_DIR"

# # Debug logging
# echo "Ghidra Path: $GHIDRA_PATH"
# echo "Project Directory: $PROJECT_DIR"
# echo "Project Name: $PROJECT_NAME"
# echo "Script Path: $SCRIPT_PATH"
# echo "Binary File: $BINARY_FILE"
echo "XAXAAXXAXAAXXAXAXAXAAXXAAXAXXAAXAXAXXAXAXXAXAXAXA"
"$GHIDRA_PATH/support/analyzeHeadless" "$PROJECT_DIR" "$PROJECT_NAME" -import $1 -postScript "$SCRIPT_PATH"

rm -r "$PROJECT_DIR"
