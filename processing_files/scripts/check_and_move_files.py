import os
import shutil

def check_and_move_files(source_dir, target_dir, destination_dir):
    # Create the destination directory if it doesn't exist
    if not os.path.exists(destination_dir):
        os.makedirs(destination_dir)
    
    # List all files in the source directory
    source_files = os.listdir(source_dir)
    
    # List all files in the target directory
    target_files = os.listdir(target_dir)
    
    # Create a set of target files for quick lookup
    target_files_set = set(target_files)
    
    # Iterate through each file in the source directory
    for file_name in source_files:
        # Remove the 'analysis_' prefix and '.json' suffix from the file name
        if file_name.startswith('analysis_') and file_name.endswith('.json'):
            base_name = file_name[len('analysis_'):-5]  # Remove prefix and suffix
            
            # Check if the base file exists in the target directory
            if base_name in target_files_set:
                print(f"File {base_name} exists in both directories.")
                # Move the base file from the target directory to the destination directory
                source_file_path = os.path.join(target_dir, base_name)
                destination_file_path = os.path.join(destination_dir, base_name)
                shutil.move(source_file_path, destination_file_path)
                print(f"Moved {base_name} to {destination_dir}.")
            else:
                print(f"File {base_name} does not exist in the target directory.")
        else:
            print(f"File {file_name} does not match the expected pattern.")

# Example usage
source_dir = '../data/'  # Replace with your source directory path containing .json files
target_dir = '../capa-testfiles-master/'  # Replace with your target directory path containing actual files
destination_dir = '../analysed_files'  # Replace with your destination directory path

check_and_move_files(source_dir, target_dir, destination_dir)