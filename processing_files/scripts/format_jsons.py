import argparse
import json
import os


def reformat_json_file(file_path):
    # Read the existing JSON data
    with open(file_path, "r") as file:
        data = json.load(file)

    # Extract the status
    status = data.pop("status", None)

    # Extract the capabilities
    capabilities = {key: value for key, value in data.items() if isinstance(value, int)}

    # Remove capabilities from the main dictionary
    for key in capabilities.keys():
        data.pop(key)

    # Add the capabilities and status back to the data
    data["capabilities"] = capabilities
    if status:
        data["status"] = status

    # Write the updated JSON data back to the file
    with open(file_path, "w") as file:
        json.dump(data, file, indent=4)


def reformat_json_files_in_directory(directory):
    for filename in os.listdir(directory):
        if filename.endswith(".json"):
            file_path = os.path.join(directory, filename)
            reformat_json_file(file_path)


if __name__ == "__main__":
    # Set up argument parsing
    parser = argparse.ArgumentParser(description="Reformat JSON files.")
    parser.add_argument(
        "directory", type=str, help="The directory containing JSON files."
    )
    args = parser.parse_args()

    # Reformat the JSON files in the provided directory
    reformat_json_files_in_directory(args.directory)
